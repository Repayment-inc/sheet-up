{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/book.json",
  "title": "Book",
  "type": "object",
  "required": ["schemaVersion", "book", "sheets"],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "book": {
      "type": "object",
      "required": ["id", "name", "createdAt"],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "name": { "$ref": "#/$defs/nonEmptyString" },
        "createdAt": { "$ref": "#/$defs/dateTime" },
        "updatedAt": { "$ref": "#/$defs/dateTime" },
        "properties": {
          "type": "object",
          "properties": {
            "defaultFormat": { "type": "string" },
            "locked": { "type": "boolean" }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "sheets": {
      "type": "array",
      "items": { "$ref": "#/$defs/sheet" },
      "default": []
    }
  },
  "additionalProperties": false,
  "$defs": {
    "id": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]{4,64}$"
    },
    "nonEmptyString": {
      "type": "string",
      "minLength": 1
    },
    "dateTime": {
      "type": "string",
      "format": "date-time"
    },
    "sheet": {
      "type": "object",
      "required": ["id", "name", "gridSize", "rows"],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "name": { "$ref": "#/$defs/nonEmptyString" },
        "gridSize": {
          "type": "object",
          "required": ["rows", "cols"],
          "properties": {
            "rows": { "type": "integer", "minimum": 1 },
            "cols": { "type": "integer", "minimum": 1 }
          },
          "additionalProperties": false
        },
        "settings": {
          "type": "object",
          "properties": {
            "locked": { "type": "boolean" },
            "tabColor": { "type": "string" }
          },
          "additionalProperties": true
        },
        "rows": {
          "type": "object",
          "patternProperties": {
            "^[1-9][0-9]*$": { "$ref": "#/$defs/row" }
          },
          "additionalProperties": false,
          "default": {}
        }
      },
      "additionalProperties": false
    },
    "row": {
      "type": "object",
      "patternProperties": {
        "^[A-Z]+$": { "$ref": "#/$defs/cell" }
      },
      "additionalProperties": false,
      "default": {}
    },
    "cell": {
      "type": "object",
      "required": ["value", "type"],
      "properties": {
        "value": {
          "type": ["string", "number", "boolean", "null"]
        },
        "type": {
          "enum": ["string", "number", "boolean", "date", "formula", "empty"]
        },
        "format": { "type": "string" },
        "formula": { "type": "string" },
        "comment": { "type": "string" },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    }
  }
}
